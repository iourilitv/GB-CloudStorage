# Updating after the project acceptance. 
GeekBrains. Курсовая работа: Итоговый проект Cloud Storage.
@Litvinenko Yuriy

Скриншшот GUI https://yadi.sk/i/AwTDqr84PshnQA
Видео https://youtu.be/ku0okBn_zGM

## 1.Issues and developments.
1. Перенесено в pr-upd2-after-acceptance.md.
2. Перенесено в pr-upd2-after-acceptance.md.
3. DONE. Netty. Разобраться как сохраняется ctx в HashMap authorizedUser - почему в его объекте указан AuthMessage/CommandMessage. 
    Из-за чего эти объекты распознаются как не одинаковые, хотя ID у них одинаковые. 
    Из-за этого пришлось использовать логин в качестве ключа. 
    Но тогда дольше искать соединение, если зарегистрированный клиент разрывает соединение нештатно, 
    т.к. в этот момент AuthGateway известно только ctx. 
    Нашел в чем проблема. Нужно сравнивать не ctx, a каналы вызвав ctx.channel(), что является правой частью 
    ctx: ChannelHandlerContext(AuthGateway#0, [id: 0xfc3d7f10, L:/127.0.0.1:8189 - R:/127.0.0.1:59762]).
    И id: и другие параметры относятся именно к каналу, а не к ctx.
    А в левой части указывается ChannelHandler, вызываемый ctx.handler(): (AuthGateway#0, например).
4. Перенесено в pr-upd2-after-acceptance.md.
5. Перенесено в pr-upd2-after-acceptance.md.
6. DONE. FileFrags. Исправить передачу и сшивание больших файлов. 
    Возможно проблему целостности итогового файла(Вопрос 1) можно решить так:
	- создавать новый массив для каждого фрагмента. 
	    Да, это помогло, но не оптимально, т.к. много объектов создается и удаляется;
	- DONE. следующий фрагмент запускать только после получения подтвержденния получения и сохранения текущего фрагмента.
    Вывод. Причина была в том, что т.к. ссылка вела на один и тот же байтовый массив,
    то получалось, что новый пакет байтов начинал записываться в него еще до завершения отправки сообщения.
    Поэтому получатель получал набор байт не соотвествующих номеру фрагмента.
    Решить удалось добавив обратную связь и защелку в цикл нарезки файла и отправки фрагментов.
7. DONE. File. Добавить проверку контрольной суммы при отправке байтового массива, целого файла и сравнивать его с сохраненным и собранным.
8. DONE. DB. Добавить базу данных в процесс регистрации пользователей.
    - подключение к MySQL, регистрация и авторизация через БД;
	- скрывать пароли с помощью "хэширования с солью".
9. DONE. Заменить класс команд на enum. По примеру:
    public enum Data {
        A, B, C;
    }
    public static void main(String[] args) {
        test(Data.A);
        test(Data.B);
        test(Data.C);
    }
    public static void test(Data e_num){
        switch (e_num) {
            case A:
                System.out.println(e_num);//A
                break;
            case B:
                System.out.println(e_num);//B
                break;
            case C:
                System.out.println(e_num);//C
                break;
        }
    }
10. DONE. GUI.File. Добавить в меню выбор абсолютного пути к корневой папке клиента.
11. DONE. Добавить конфигурационный файл для клиента со следующими полями:
    <Root_default>"storage"</>
    <Root_absolute>""</> //в начальном запуске - пустой, но при смене пользователем 
    корневой директории будет указан абсолютный путь(например - D:\cloudstorage\storage\).
    И добавить логику установки начальных параметров при каждом запуске.
12. DONE.Добавить конфигурационный файл для сервера со следующими полями:
    <Root_default>"storage"</>
    <Root_absolute>""</> //сисадмин может указать, тогда в начальном запуске
    корневая директория сервера будет изменена на абсолютную.
    И добавить логику установки начальных параметров при запуске.
13. DONE. (json-object).Нужно в клиента и сервера добавить при запуске приложения создание каталога storage, в папке 
    где разворачивается jar-файл, с условием «если еще нет такой директории».
14. DONE. Добавить readme.txt файлы в [client] и [server] (уже создал файл в resources) 
    и копировать их в корневую директорию jar при первом старте приложения.
15. DONE. GUI. Добавить функционал "Сменить пароль" в GUI.
    DONE. В UsersAuthController уже добавлен метод, чтобы изменить данные в БД.
16. DONE. GUI. Разделить форму авторизации(Login.fxml)) на две: авторизация и регистрация.
    DONE. Добавить поля в регистрационную форму: first_name, last_name, email.
    DONE. В БД такие поля уже созданы.
17. DONE. DB. Индексировать поиск пользователей в БД по логину и email.
	- применил первичный ключ на login и ключ на email. Теперь поиск оптимизирован до 
	Single Row(constant) по обоим полям, но если искать по отдельности.
18. DONE. Netty. Устранить исключение на сервере при разрыве соединения с неавторизованным
    клиентом.
19. DONE.GUI. Добавить возвращение в исходное состояние при разрыве соединения с сервером
    в неавторизованном режиме.
20. Перенесено в pr-upd2-after-acceptance.md.
21. Перенесено в pr-upd2-after-acceptance.md.
22. Перенесено в pr-upd2-after-acceptance.md.
    

